---
Title: "AAI1001 Data Engineering and Visualization Group 3 Project"
Author: "Group 3"
embed-resources: true
format:
  html:
    toc: true
    toc-depth: 2
    toc-location: left
    number-sections: true
    number-depth: 2
editor: 
  markdown: 
    wrap: 72
---

<font size="6"> **Team Project Proposal** </font>

**Authors:**\

-   **Muhammad Azreen Bin Muhammad (2200581)**
-   **Fun Kai Jun (2303556)**
-   **Chng Song Heng Aloysius (2302857)**
-   **Shaikh Mohamed Irfan (2302696)**
-   **Yeo Ya Xuan Beata (2302775)**

For this document, the following packages are required:

```{r}
#| label: setup 
#| include: true
library(knitr)
library(readxl)
suppressPackageStartupMessages(library(tidyverse))
library(dplyr)
library(here)
```

# Original Data Visualization in News Media

The geographical distribution of Singapore's population is a focal point
of urban studies and public policy discussions. The introduction of a
new visualization of demographic trends across various planning areas
provides a novel perspective on this discourse. Our project aims to
dissect the relationship between demographic characteristics and urban
planning policies. The observed patterns, while not entirely random, may
be consistent with hypotheses regarding the impact of strategic urban
development on population distribution as seen in @fig-1.

Our visualization, inspired by the seminal work of the Singapore
Department of Statistics
([2023](https://www.singstat.gov.sg/-/media/files/publications/population/population2023.ashx)),
encapsulates data from the year 2023, a period marked by significant
urban and demographic changes. While our initial rendition has been
commended for its clarity in showcasing trends, it is the addition of
interactive elements that promises a deeper engagement with the data.
Nonetheless, we acknowledge room for improvement. Incorporating
interactive toggles, expanded temporal ranges, and detailed geospatial
mappings will refine our approach, providing a more comprehensive
exploration of how urban planning influences demographic distribution
and housing patterns in Singapore.

![Visualization of Choropleth Map of Resident Population Density by the
Department of Statistics Singapore ([Singstat
2023](https://www.singstat.gov.sg/-/media/files/publications/population/population2023.ashx))](Images/Figure1.png){#fig-1}

# Critical Assessment of the Original The selected visualization from

The Singapore Department of Statistics presents several variables:
population distribution (quantitative) and planning areas (categorical).
Additionally, the visualization includes a heatmap that allow users to
delve into subzones to see pattern in land development and population
over time.

However, there are some shortcomings the team has identified:

1.  Complexity: While the visualization is thorough, its complexity may
    be overwhelming for some users, especially those unfamiliar with
    demographic data or geographical information systems (GIS).

2.  Accessibility: The reliance on color and detailed graphics may pose
    accessibility challenges for users with visual impairments or those
    who are not tech-savvy

3.  Data Density: The high density of information in a single
    visualization can lead to cognitive overload, where important
    details might be overlooked due to the sheer volume of data
    presented. ([Front Psychol.
    2023](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10322198/))

4.  Limited Temporal Range: The visualization only covers data for the
    year 2023, which constrains the analysis to a narrow timeframe and
    does not allow for the examination of trends over time.

5.  Lack of Customization: Users cannot customize the time range or
    select specific years of interest, limiting the depth of their
    analysis.

6.  Static Elements: While some elements are interactive, the
    visualization could benefit from more dynamic features such as
    changing bubble sizes or color gradients to depict demographic
    shifts over time.

# Proposed Improvements

We propose to address the shortcomings of the original visualization as
follows:

1.  Better contrast: Utilize high-contrast colors to improve
    accessibility for users with visual impairments, ensuring clarity
    and ease of interpretation for all users. One such example is the
    use of Color Universal Design (CUD) colors which are designed to be
    distinguishable by all users, including those with color vision
    deficiencies. ([Okabe and Ito
    2008](https://jfly.uni-koeln.de/color/))

2.  Reduced Data Density: Simplify the presentation by reducing the
    number of data points displayed simultaneously, thus preventing
    overcrowding and making the visualization more comprehensible.

3.  Interactive Elements: Hovering over a country will display a tooltip
    with detailed information on the population size of a certain region
    of singapore as well as the age profile.

4.  Expanded Temporal Ranges: Introduce options for users to select
    specific time periods for analysis, facilitating a deeper
    exploration of trends over time.

# Data Cleaning

The Singapore Department of Statistics based its visualization on data
collected by the Singapore Government from the year 2023 available in
CSV format. The data includes the following columns: Planning Area,
Population, Age Profile, and Gender
([2023](https://www.singstat.gov.sg/find-data/search-by-theme/population/geographic-distribution/latest-data)).
For our improved visualization we will be using dataset dating as far
back as 2000 to 2023. The department of statistics categorize the data
into a range of 10 years (e.g 2000-2010, 2011-2020) and for data set
that have not met the 10 year range are given in seperate files instead.
As such we will first have to combined the data into a single file and
then clean the data to ensure that it is in a Dataframe.

```{r}
# Set the working directory to the root of the project folder
setwd(here::here())

# List all CSV files in the data folder
file_list <- list.files("data", pattern = "*.csv")

# Print the list of files
print(file_list)

# Read and combine all CSV files
csv_list <- lapply(file_list, function(x) read.csv(file.path("data", x)))
df <- do.call(rbind, csv_list)

# Save the combined data frame to a new CSV file (optional if you want to view it before we start cleaning) 
# write.csv(df, file.path("data", "combined_data.csv"), row.names = FALSE)
```

Once the data has been combined, we will perform a summary of the data
using the glimpse() and tail() function to understand the structure of
the data and identify any missing values or inconsistencies.

```{r}
# Display the first few rows of the combined data frame
head(df)
# Display the last few rows of the combined data frame
tail(df)
```

We can check the total number of rows in the data frame.

```{r}
# Display the total number of rows in the data frame
nrow(df)
```

Based on the data type and structure, we will remove the columns that
are not relevant to our visualization and clean the remaining columns to
ensure consistency and accuracy. We will also aggregate the data to
create a new data frame that consolidates the total population by age
group, planning area, and time period.

```{r}
# Deleting "SZ" and "Sex" columns as they are not relevant to our visualization
df <- df %>% select(-"SZ", -"Sex")
# Function to create age groups from 1,2,3,4... to 1-9, 10,19...
create_age_group <- function(age) {
  if (age == "90_and_over" || age == "90_and_Over") {
    return("90 and Over")
  } else {
    age_num <- as.numeric(age)
    group_start <- (age_num %/% 10) * 10
    group_end <- group_start + 9
    return(paste0(group_start, " to ", group_end))
  }
}
# Mutating the age column into a new AgeGroup column
df <- df %>% mutate(AgeGroup = sapply(Age, create_age_group))

head(df)

```

Next, we will clean the 'Pop' and by removing any non-numeric characters
and convert it to a numeric data type for aggregation to make the
dataframe more memory efficient as having char data type for these
columns can take up alot of memory usage which can hamper the work flow.
Within one of the original data set, the data gathered in 2000, had a
group of which did not state which Planning Area they were staying in.
As such we will remove these rows as it is not relevant to our
visualization. Afterwards we will then aggregate the data to calculate
the total population by age group, planning area, and time period.

```{r}
# Function to clean the 'Pop' column by removing non-numeric characters
clean_pop <- function(pop) {
  # Remove any non-digit characters
  clean_pop <- gsub("[^0-9]", "", pop)
  return(clean_pop)
}
# Function to drop any row containing "Not Stated" in the PA column as this is not relevant to our visualization
drop_not_stated <- function(df, column_name = "PA") {
  # Filter out rows where the specified column contains "Not Stated"
  df <- df %>% filter(!(.data[[column_name]] == "Not Stated"))
  return(df)
}
# Apply the drop_not_stated function to the dataframe
df<- drop_not_stated(df, "PA")
# Apply the cleaning function to the 'Pop' column
df$Pop <- sapply(df$Pop, clean_pop)
# Convert Pop to numeric for aggregation
df$Pop <- as.numeric(df$Pop)
# Move columns to a new data frame to consolidate total population, Age Group and Time
aggregated_df <- df %>%
  group_by(PA, AgeGroup, Time) %>%
  summarise(TotalPop = sum(Pop, na.rm = TRUE))

head(aggregated_df)
```

We can save the cleaned data to a new CSV file for future use.

```{r}
# Saved for future use
write_csv(aggregated_df, "cleaned_data.csv")
```

```{r}
# Load the libraries
library(sf)
library(ggplot2)

# Define the path to your KML file (ensure this path is correct)
kml_file_path <- "singapore.kml"

# Read the KML file
singapore_map <- st_read(kml_file_path)

# Inspect the KML data to understand its structure
print(head(singapore_map))

# Plot the map with ggplot2
ggplot(data = singapore_map) +
  geom_sf() +
  theme_minimal() +
  labs(title = "Planning Areas in Singapore",
       x = "Longitude",
       y = "Latitude")


```

# Conclusion

The data is now ready for visualization. The next step will be to create
a plot that can effectively communicate the relationship between the
population density in each region of Singapore over time, and
additionally allow curious readers to explore the data even further
using interactivity. We will use ggplot2 package to create the plot, and
plotly to add interactivity.

# References

1.  Arnold, M., Goldschmitt, M., & Rigotti, T. (2023, June 21). Dealing
    with information overload: A comprehensive review. Frontiers in
    psychology. <https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10322198/>

2.  Okabe, M., & Ito, K. (2008). Color Universal Design (CUD): How to
    make figures and presentations that are friendly to Colorblind
    people. <https://jfly.uni-koeln.de/color/>

3.  Singapore Department of Statistics. (2023). Population Trends 2023.
    <https://www.singstat.gov.sg/-/media/files/publications/population/population2023.ashx>

4.  Department of Statistics Singapore. (2000 - 2023). Singapore
    Residents by Planning Area / Subzone, Single Year of Age and Sex
    (June 2000-2010, June 2011-2020, June 2021, June 2022, June 2023)
    \[Data set\].
    <https://www.singstat.gov.sg/find-data/search-by-theme/population/geographic-distribution/latest-data>
